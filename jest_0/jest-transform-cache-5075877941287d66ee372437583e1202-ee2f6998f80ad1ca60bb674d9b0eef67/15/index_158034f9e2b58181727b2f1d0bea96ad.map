{"version":3,"sources":["index.js"],"names":["uuid","require","verifySignature","Transaction","constructor","senderWallet","receiver","amount","id","outputMap","createOutputMap","input","createInput","validateTransaction","transaction","address","signature","outputTotal","Object","values","reduce","total","outputAmount","console","log","publicKey","data","balance","timestamp","Date","now","sign","module","exports"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,SAAD,CAApB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAsBD,OAAO,CAAC,mBAAD,CAAnC;;AAEA,MAAME,WAAN,CAAkB;AAChBC,EAAAA,WAAW,CAAC;AAAEC,IAAAA,YAAF;AAAgBC,IAAAA,QAAhB;AAA0BC,IAAAA;AAA1B,GAAD,EAAqC;AAC9C,SAAKC,EAAL,GAAUR,IAAI,EAAd;AACA,SAAKS,SAAL,GAAiB,KAAKC,eAAL,CAAqB;AAAEL,MAAAA,YAAF;AAAgBC,MAAAA,QAAhB;AAA0BC,MAAAA;AAA1B,KAArB,CAAjB;AACA,SAAKI,KAAL,GAAa,KAAKC,WAAL,CAAiB;AAAEP,MAAAA,YAAF;AAAgBI,MAAAA,SAAS,EAAE,KAAKA;AAAhC,KAAjB,CAAb;AACD;;AAED,SAAOI,mBAAP,CAA2BC,WAA3B,EAAwC;AACtC,UAAM;AACJH,MAAAA,KAAK,EAAE;AAAEI,QAAAA,OAAF;AAAWR,QAAAA,MAAX;AAAmBS,QAAAA;AAAnB,OADH;AAEJP,MAAAA;AAFI,QAGFK,WAHJ;AAKA,UAAMG,WAAW,GAAGC,MAAM,CAACC,MAAP,CAAcV,SAAd,EAAyBW,MAAzB,CAClB,CAACC,KAAD,EAAQC,YAAR,KAAyBD,KAAK,GAAGC,YADf,CAApB;;AAIA,QAAIf,MAAM,KAAKU,WAAf,EAA4B;AAC1BM,MAAAA,OAAO,CAACC,GAAR,CAAY,mCAAmCT,OAA/C;AACA,aAAO,KAAP;AACD;;AACD,QAAI,CAACb,eAAe,CAAC;AAAEuB,MAAAA,SAAS,EAAEV,OAAb;AAAsBW,MAAAA,IAAI,EAAEjB,SAA5B;AAAuCO,MAAAA;AAAvC,KAAD,CAApB,EAA0E;AACxEO,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAiCT,OAA7C;AACA,aAAO,KAAP;AACD;;AACD,WAAO,IAAP;AACD;;AAEDL,EAAAA,eAAe,CAAC;AAAEL,IAAAA,YAAF;AAAgBC,IAAAA,QAAhB;AAA0BC,IAAAA;AAA1B,GAAD,EAAqC;AAClD,UAAME,SAAS,GAAG,EAAlB;AAEAA,IAAAA,SAAS,CAACH,QAAD,CAAT,GAAsBC,MAAtB;AACAE,IAAAA,SAAS,CAACJ,YAAY,CAACoB,SAAd,CAAT,GAAoCpB,YAAY,CAACsB,OAAb,GAAuBpB,MAA3D;AAEA,WAAOE,SAAP;AACD;;AAEDG,EAAAA,WAAW,CAAC;AAAEP,IAAAA,YAAF;AAAgBI,IAAAA;AAAhB,GAAD,EAA8B;AACvC,WAAO;AACLmB,MAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EADN;AAELvB,MAAAA,MAAM,EAAEF,YAAY,CAACsB,OAFhB;AAGLZ,MAAAA,OAAO,EAAEV,YAAY,CAACoB,SAHjB;AAILT,MAAAA,SAAS,EAAEX,YAAY,CAAC0B,IAAb,CAAkBtB,SAAlB;AAJN,KAAP;AAMD;;AA5Ce;;AA+ClBuB,MAAM,CAACC,OAAP,GAAiB9B,WAAjB","sourcesContent":["const uuid = require(\"uuid/v1\");\r\nconst { verifySignature } = require(\"../../utils/index\");\r\n\r\nclass Transaction {\r\n  constructor({ senderWallet, receiver, amount }) {\r\n    this.id = uuid();\r\n    this.outputMap = this.createOutputMap({ senderWallet, receiver, amount });\r\n    this.input = this.createInput({ senderWallet, outputMap: this.outputMap });\r\n  }\r\n\r\n  static validateTransaction(transaction) {\r\n    const {\r\n      input: { address, amount, signature },\r\n      outputMap\r\n    } = transaction;\r\n\r\n    const outputTotal = Object.values(outputMap).reduce(\r\n      (total, outputAmount) => total + outputAmount\r\n    );\r\n\r\n    if (amount !== outputTotal) {\r\n      console.log(\"Log: Invalid transaction from \" + address);\r\n      return false;\r\n    }\r\n    if (!verifySignature({ publicKey: address, data: outputMap, signature })) {\r\n      console.log(\"Log: Invalid signature from \" + address);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  createOutputMap({ senderWallet, receiver, amount }) {\r\n    const outputMap = {};\r\n\r\n    outputMap[receiver] = amount;\r\n    outputMap[senderWallet.publicKey] = senderWallet.balance - amount;\r\n\r\n    return outputMap;\r\n  }\r\n\r\n  createInput({ senderWallet, outputMap }) {\r\n    return {\r\n      timestamp: Date.now(),\r\n      amount: senderWallet.balance,\r\n      address: senderWallet.publicKey,\r\n      signature: senderWallet.sign(outputMap)\r\n    };\r\n  }\r\n}\r\n\r\nmodule.exports = Transaction;\r\n"]}