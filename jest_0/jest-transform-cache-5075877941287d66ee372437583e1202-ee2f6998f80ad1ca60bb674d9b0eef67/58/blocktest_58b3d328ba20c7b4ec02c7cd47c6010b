d9663de29c5cef7fb91b661a582bb137
const Block = require("../blockchain/block");

const cryptoHash = require("../utils/crypto-hash");

const {
  GENESIS_DATA
} = require("../config");

describe("Block", () => {
  const timestamp = "a-date";
  const previousHash = "foo-hash";
  const hash = "bar-hash";
  const data = ["Blockchain", "data"];
  const nonce = 1;
  const difficulty = 1;
  const block = new Block({
    timestamp,
    previousHash,
    hash,
    data,
    nonce,
    difficulty
  });
  it("has a hash, previousHash, timestamp & data", () => {
    expect(block.timestamp).toEqual(timestamp);
    expect(block.previousHash).toEqual(previousHash);
    expect(block.hash).toEqual(hash);
    expect(block.data).toEqual(data);
    expect(block.nonce).toEqual(nonce);
    expect(block.difficulty).toEqual(difficulty);
  });
  describe("genesis()", () => {
    const genesisBlock = Block.genesis();
    it("returns a Block instance", () => {
      expect(genesisBlock instanceof Block).toBe(true);
    });
    it("returns genesis data", () => {
      expect(genesisBlock).toEqual(GENESIS_DATA);
    });
  });
  describe("mineblock()", () => {
    const lastBlock = Block.genesis();
    const data = "mined-block";
    const minedBlock = Block.mineBlock({
      lastBlock,
      data
    });
    it("returns a Block instance", () => {
      expect(minedBlock instanceof Block).toBe(true);
    });
    it("sets `previousHash` to be `hash` of the previous block", () => {
      expect(minedBlock.previousHash).toEqual(lastBlock.hash);
    });
    it("sets the `data`", () => {
      expect(minedBlock.data).toEqual(data);
    });
    it("sets the `timestamp`", () => {
      expect(minedBlock.timestamp).not.toEqual(undefined);
    });
    it("creates sha256 based on params", () => {
      expect(minedBlock.hash).toEqual(cryptoHash(minedBlock.timestamp, minedBlock.nonce, minedBlock.difficulty, lastBlock.hash, data));
    });
    it("has 0s that respect the difficulty criteria", () => {
      expect(minedBlock.hash.substring(0, minedBlock.difficulty)).toEqual("0".repeat(minedBlock.difficulty));
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJsb2NrLnRlc3QuanMiXSwibmFtZXMiOlsiQmxvY2siLCJyZXF1aXJlIiwiY3J5cHRvSGFzaCIsIkdFTkVTSVNfREFUQSIsImRlc2NyaWJlIiwidGltZXN0YW1wIiwicHJldmlvdXNIYXNoIiwiaGFzaCIsImRhdGEiLCJub25jZSIsImRpZmZpY3VsdHkiLCJibG9jayIsIml0IiwiZXhwZWN0IiwidG9FcXVhbCIsImdlbmVzaXNCbG9jayIsImdlbmVzaXMiLCJ0b0JlIiwibGFzdEJsb2NrIiwibWluZWRCbG9jayIsIm1pbmVCbG9jayIsIm5vdCIsInVuZGVmaW5lZCIsInN1YnN0cmluZyIsInJlcGVhdCJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMscUJBQUQsQ0FBckI7O0FBQ0EsTUFBTUMsVUFBVSxHQUFHRCxPQUFPLENBQUMsc0JBQUQsQ0FBMUI7O0FBQ0EsTUFBTTtBQUFFRSxFQUFBQTtBQUFGLElBQW1CRixPQUFPLENBQUMsV0FBRCxDQUFoQzs7QUFFQUcsUUFBUSxDQUFDLE9BQUQsRUFBVSxNQUFNO0FBQ3RCLFFBQU1DLFNBQVMsR0FBRyxRQUFsQjtBQUNBLFFBQU1DLFlBQVksR0FBRyxVQUFyQjtBQUNBLFFBQU1DLElBQUksR0FBRyxVQUFiO0FBQ0EsUUFBTUMsSUFBSSxHQUFHLENBQUMsWUFBRCxFQUFlLE1BQWYsQ0FBYjtBQUNBLFFBQU1DLEtBQUssR0FBRyxDQUFkO0FBQ0EsUUFBTUMsVUFBVSxHQUFHLENBQW5CO0FBQ0EsUUFBTUMsS0FBSyxHQUFHLElBQUlYLEtBQUosQ0FBVTtBQUN0QkssSUFBQUEsU0FEc0I7QUFFdEJDLElBQUFBLFlBRnNCO0FBR3RCQyxJQUFBQSxJQUhzQjtBQUl0QkMsSUFBQUEsSUFKc0I7QUFLdEJDLElBQUFBLEtBTHNCO0FBTXRCQyxJQUFBQTtBQU5zQixHQUFWLENBQWQ7QUFTQUUsRUFBQUEsRUFBRSxDQUFDLDRDQUFELEVBQStDLE1BQU07QUFDckRDLElBQUFBLE1BQU0sQ0FB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QWhCLENBQTBCLENBQTFCLEVBQTZCSixVQUFVLENBQUNULFVBQXhDLENBQUQsQ0FBTixDQUE0REksT0FBNUQsQ0FDRSxJQUFJVSxNQUFKLENBQVdMLFVBQVUsQ0FBQ1QsVUFBdEIsQ0FERjtBQUdELEtBSkMsQ0FBRjtBQUtELEdBdENPLENBQVI7QUF1Q0QsQ0E1RU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEJsb2NrID0gcmVxdWlyZShcIi4uL2Jsb2NrY2hhaW4vYmxvY2tcIik7XHJcbmNvbnN0IGNyeXB0b0hhc2ggPSByZXF1aXJlKFwiLi4vdXRpbHMvY3J5cHRvLWhhc2hcIik7XHJcbmNvbnN0IHsgR0VORVNJU19EQVRBIH0gPSByZXF1aXJlKFwiLi4vY29uZmlnXCIpO1xyXG5cclxuZGVzY3JpYmUoXCJCbG9ja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgdGltZXN0YW1wID0gXCJhLWRhdGVcIjtcclxuICBjb25zdCBwcmV2aW91c0hhc2ggPSBcImZvby1oYXNoXCI7XHJcbiAgY29uc3QgaGFzaCA9IFwiYmFyLWhhc2hcIjtcclxuICBjb25zdCBkYXRhID0gW1wiQmxvY2tjaGFpblwiLCBcImRhdGFcIl07XHJcbiAgY29uc3Qgbm9uY2UgPSAxO1xyXG4gIGNvbnN0IGRpZmZpY3VsdHkgPSAxO1xyXG4gIGNvbnN0IGJsb2NrID0gbmV3IEJsb2NrKHtcclxuICAgIHRpbWVzdGFtcCxcclxuICAgIHByZXZpb3VzSGFzaCxcclxuICAgIGhhc2gsXHJcbiAgICBkYXRhLFxyXG4gICAgbm9uY2UsXHJcbiAgICBkaWZmaWN1bHR5XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiaGFzIGEgaGFzaCwgcHJldmlvdXNIYXNoLCB0aW1lc3RhbXAgJiBkYXRhXCIsICgpID0+IHtcclxuICAgIGV4cGVjdChibG9jay50aW1lc3RhbXApLnRvRXF1YWwodGltZXN0YW1wKTtcclxuICAgIGV4cGVjdChibG9jay5wcmV2aW91c0hhc2gpLnRvRXF1YWwocHJldmlvdXNIYXNoKTtcclxuICAgIGV4cGVjdChibG9jay5oYXNoKS50b0VxdWFsKGhhc2gpO1xyXG4gICAgZXhwZWN0KGJsb2NrLmRhdGEpLnRvRXF1YWwoZGF0YSk7XHJcbiAgICBleHBlY3QoYmxvY2subm9uY2UpLnRvRXF1YWwobm9uY2UpO1xyXG4gICAgZXhwZWN0KGJsb2NrLmRpZmZpY3VsdHkpLnRvRXF1YWwoZGlmZmljdWx0eSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwiZ2VuZXNpcygpXCIsICgpID0+IHtcclxuICAgIGNvbnN0IGdlbmVzaXNCbG9jayA9IEJsb2NrLmdlbmVzaXMoKTtcclxuXHJcbiAgICBpdChcInJldHVybnMgYSBCbG9jayBpbnN0YW5jZVwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChnZW5lc2lzQmxvY2sgaW5zdGFuY2VvZiBCbG9jaykudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwicmV0dXJucyBnZW5lc2lzIGRhdGFcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoZ2VuZXNpc0Jsb2NrKS50b0VxdWFsKEdFTkVTSVNfREFUQSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJtaW5lYmxvY2soKVwiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBsYXN0QmxvY2sgPSBCbG9jay5nZW5lc2lzKCk7XHJcbiAgICBjb25zdCBkYXRhID0gXCJtaW5lZC1ibG9ja1wiO1xyXG4gICAgY29uc3QgbWluZWRCbG9jayA9IEJsb2NrLm1pbmVCbG9jayh7IGxhc3RCbG9jaywgZGF0YSB9KTtcclxuXHJcbiAgICBpdChcInJldHVybnMgYSBCbG9jayBpbnN0YW5jZVwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChtaW5lZEJsb2NrIGluc3RhbmNlb2YgQmxvY2spLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNldHMgYHByZXZpb3VzSGFzaGAgdG8gYmUgYGhhc2hgIG9mIHRoZSBwcmV2aW91cyBibG9ja1wiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChtaW5lZEJsb2NrLnByZXZpb3VzSGFzaCkudG9FcXVhbChsYXN0QmxvY2suaGFzaCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNldHMgdGhlIGBkYXRhYFwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChtaW5lZEJsb2NrLmRhdGEpLnRvRXF1YWwoZGF0YSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNldHMgdGhlIGB0aW1lc3RhbXBgXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KG1pbmVkQmxvY2sudGltZXN0YW1wKS5ub3QudG9FcXVhbCh1bmRlZmluZWQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJjcmVhdGVzIHNoYTI1NiBiYXNlZCBvbiBwYXJhbXNcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QobWluZWRCbG9jay5oYXNoKS50b0VxdWFsKFxyXG4gICAgICAgIGNyeXB0b0hhc2goXHJcbiAgICAgICAgICBtaW5lZEJsb2NrLnRpbWVzdGFtcCxcclxuICAgICAgICAgIG1pbmVkQmxvY2subm9uY2UsXHJcbiAgICAgICAgICBtaW5lZEJsb2NrLmRpZmZpY3VsdHksXHJcbiAgICAgICAgICBsYXN0QmxvY2suaGFzaCxcclxuICAgICAgICAgIGRhdGFcclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcImhhcyAwcyB0aGF0IHJlc3BlY3QgdGhlIGRpZmZpY3VsdHkgY3JpdGVyaWFcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QobWluZWRCbG9jay5oYXNoLnN1YnN0cmluZygwLCBtaW5lZEJsb2NrLmRpZmZpY3VsdHkpKS50b0VxdWFsKFxyXG4gICAgICAgIFwiMFwiLnJlcGVhdChtaW5lZEJsb2NrLmRpZmZpY3VsdHkpXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==