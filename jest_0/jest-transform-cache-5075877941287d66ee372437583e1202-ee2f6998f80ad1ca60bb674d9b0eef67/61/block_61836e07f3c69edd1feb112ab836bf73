ba23a0ff0512ab6776346ec604fa2578
const {
  GENESIS_DATA
} = require("../config");

const cryptoHash = require("../utils/crypto-hash");

class Block {
  constructor({
    timestamp,
    previousHash,
    hash,
    data,
    nonce,
    difficulty
  }) {
    this.timestamp = timestamp;
    this.previousHash = previousHash;
    this.hash = hash;
    this.data = data;
    this.nonce = nonce;
    this.difficulty = difficulty;
  }

  static genesis() {
    return new this(GENESIS_DATA);
  }

  static mineBlock({
    lastBlock,
    data
  }) {
    let hash, timestamp;
    const previousHash = lastBlock.hash;
    const {
      difficulty
    } = lastBlock;
    let nonce = 0;

    do {
      nonce++;
      timestamp = Date.now();
      hash = cryptoHash(timestamp, previousHash, difficulty, nonce, data);
    } while (hash.substring(0, difficulty) !== "0".repeat(difficulty));

    return new this({
      timestamp,
      previousHash,
      difficulty,
      nonce,
      hash,
      data
    });
  }

}

module.exports = Block;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJsb2NrLmpzIl0sIm5hbWVzIjpbIkdFTkVTSVNfREFUQSIsInJlcXVpcmUiLCJjcnlwdG9IYXNoIiwiQmxvY2siLCJjb25zdHJ1Y3RvciIsInRpbWVzdGFtcCIsInByZXZpb3VzSGFzaCIsImhhc2giLCJkYXRhIiwibm9uY2UiLCJkaWZmaWN1bHR5IiwiZ2VuZXNpcyIsIm1pbmVCbG9jayIsImxhc3RCbG9jayIsIkRhdGUiLCJub3ciLCJzdWJzdHJpbmciLCJyZXBlYXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBbUJDLE9BQU8sQ0FBQyxXQUFELENBQWhDOztBQUNBLE1BQU1DLFVBQVUsR0FBR0QsT0FBTyxDQUFDLHNCQUFELENBQTFCOztBQUVBLE1BQU1FLEtBQU4sQ0FBWTtBQUNWQyxFQUFBQSxXQUFXLENBQUM7QUFBRUMsSUFBQUEsU0FBRjtBQUFhQyxJQUFBQSxZQUFiO0FBQTJCQyxJQUFBQSxJQUEzQjtBQUFpQ0MsSUFBQUEsSUFBakM7QUFBdUNDLElBQUFBLEtBQXZDO0FBQThDQyxJQUFBQTtBQUE5QyxHQUFELEVBQTZEO0FBQ3RFLFNBQUtMLFNBQUwsR0FBaUJBLFNBQWpCO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQkEsWUFBcEI7QUFDQSxTQUFLQyxJQUFMLEdBQVlBLElBQVo7QUFDQSxTQUFLQyxJQUFMLEdBQVlBLElBQVo7QUFDQSxTQUFLQyxLQUFMLEdBQWFBLEtBQWI7QUFDQSxTQUFLQyxVQUFMLEdBQWtCQSxVQUFsQjtBQUNEOztBQUVELFNBQU9DLE9BQVAsR0FBaUI7QUFDZixXQUFPLElBQUksSUFBSixDQUFTWCxZQUFULENBQVA7QUFDRDs7QUFFRCxTQUFPWSxTQUFQLENBQWlCO0FBQUVDLElBQUFBLFNBQUY7QUFBYUwsSUFBQUE7QUFBYixHQUFqQixFQUFzQztBQUNwQyxRQUFJRCxJQUFKLEVBQVVGLFNBQVY7QUFDQSxVQUFNQyxZQUFZLEdBQUdPLFNBQVMsQ0FBQ04sSUFBL0I7QUFDQSxVQUFNO0FBQUVHLE1BQUFBO0FBQUYsUUFBaUJHLFNBQXZCO0FBQ0EsUUFBSUosS0FBSyxHQUFHLENBQVo7O0FBQ0EsT0FBRztBQUNEQSxNQUFBQSxLQUFLO0FBQ0xKLE1BQUFBLFNBQVMsR0FBR1MsSUFBSSxDQUFDQyxHQUFMLEVBQVo7QUFDQVIsTUFBQUEsSUFBSSxHQUFHTCxVQUFVLENBQUNHLFNBQUQsRUFBWUMsWUFBWixFQUEwQkksVUFBMUIsRUFBc0NELEtBQXRDLEVBQTZDRCxJQUE3QyxDQUFqQjtBQUNELEtBSkQsUUFJU0QsSUFBSSxDQUFDUyxTQUFMLENBQWUsQ0FBZixFQUFrQk4sVUFBbEIsTUFBa0MsSUFBSU8sTUFBSixDQUFXUCxVQUFYLENBSjNDOztBQU1BLFdBQU8sSUFBSSxJQUFKLENBQVM7QUFDZEwsTUFBQUEsU0FEYztBQUVkQyxNQUFBQSxZQUZjO0FBR2RJLE1BQUFBLFVBSGM7QUFJZEQsTUFBQUEsS0FKYztBQUtkRixNQUFBQSxJQUxjO0FBTWRDLE1BQUFBO0FBTmMsS0FBVCxDQUFQO0FBUUQ7O0FBakNTOztBQW9DWlUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCaEIsS0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IEdFTkVTSVNfREFUQSB9ID0gcmVxdWlyZShcIi4uL2NvbmZpZ1wiKTtcclxuY29uc3QgY3J5cHRvSGFzaCA9IHJlcXVpcmUoXCIuLi91dGlscy9jcnlwdG8taGFzaFwiKTtcclxuXHJcbmNsYXNzIEJsb2NrIHtcclxuICBjb25zdHJ1Y3Rvcih7IHRpbWVzdGFtcCwgcHJldmlvdXNIYXNoLCBoYXNoLCBkYXRhLCBub25jZSwgZGlmZmljdWx0eSB9KSB7XHJcbiAgICB0aGlzLnRpbWVzdGFtcCA9IHRpbWVzdGFtcDtcclxuICAgIHRoaXMucHJldmlvdXNIYXNoID0gcHJldmlvdXNIYXNoO1xyXG4gICAgdGhpcy5oYXNoID0gaGFzaDtcclxuICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLm5vbmNlID0gbm9uY2U7XHJcbiAgICB0aGlzLmRpZmZpY3VsdHkgPSBkaWZmaWN1bHR5O1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdlbmVzaXMoKSB7XHJcbiAgICByZXR1cm4gbmV3IHRoaXMoR0VORVNJU19EQVRBKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBtaW5lQmxvY2soeyBsYXN0QmxvY2ssIGRhdGEgfSkge1xyXG4gICAgbGV0IGhhc2gsIHRpbWVzdGFtcDtcclxuICAgIGNvbnN0IHByZXZpb3VzSGFzaCA9IGxhc3RCbG9jay5oYXNoO1xyXG4gICAgY29uc3QgeyBkaWZmaWN1bHR5IH0gPSBsYXN0QmxvY2s7XHJcbiAgICBsZXQgbm9uY2UgPSAwO1xyXG4gICAgZG8ge1xyXG4gICAgICBub25jZSsrO1xyXG4gICAgICB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgICBoYXNoID0gY3J5cHRvSGFzaCh0aW1lc3RhbXAsIHByZXZpb3VzSGFzaCwgZGlmZmljdWx0eSwgbm9uY2UsIGRhdGEpO1xyXG4gICAgfSB3aGlsZSAoaGFzaC5zdWJzdHJpbmcoMCwgZGlmZmljdWx0eSkgIT09IFwiMFwiLnJlcGVhdChkaWZmaWN1bHR5KSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyB0aGlzKHtcclxuICAgICAgdGltZXN0YW1wLFxyXG4gICAgICBwcmV2aW91c0hhc2gsXHJcbiAgICAgIGRpZmZpY3VsdHksXHJcbiAgICAgIG5vbmNlLFxyXG4gICAgICBoYXNoLFxyXG4gICAgICBkYXRhXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQmxvY2s7XHJcbiJdfQ==