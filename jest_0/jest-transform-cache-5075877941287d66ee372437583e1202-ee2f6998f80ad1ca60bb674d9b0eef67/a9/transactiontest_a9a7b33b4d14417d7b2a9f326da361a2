55bb88aabe4619508469cc82d1a51bf5
const Transaction = require("../wallet/transaction/index");

const Wallet = require("../wallet/index");

const {
  verifySignature
} = require("../utils/index");

describe("Transaction", () => {
  let transaction, senderWallet, receiver, amount;
  beforeEach(() => {
    senderWallet = new Wallet();
    receiver = "receiver-publicKey";
    amount = 20;
    transaction = new Transaction({
      senderWallet,
      receiver,
      amount
    });
  });
  it("has an `id`", () => {
    expect(transaction).toHaveProperty("id");
  });
  describe("outputMap", () => {
    it("has an outputMap", () => {
      expect(transaction).toHaveProperty("outputMap");
    });
    it("outputs amount of receiver", () => {
      expect(transaction.outputMap[receiver]).toEqual(amount);
    });
    it("outputs the remaining balance of the sender", () => {
      expect(transaction.outputMap[senderWallet.publicKey]).toEqual(senderWallet.balance - amount);
    });
  });
  describe("input", () => {
    it("has an `input`", () => {
      expect(transaction).toHaveProperty("input");
    });
    it("has `timestamp` in the `input`", () => {
      expect(transaction.input).toHaveProperty("timestamp");
    });
    it("sets the `amount` to the `senderWallet` balance", () => {
      console.log('Balance ', senderWallet.balance);
      expect(transaction.input.amount).toEqual(senderWallet.balance);
    });
    it("sets the `address` to the `senderWallet` publicKey", () => {
      expect(transaction.input.address).toEqual(senderWallet.publicKey);
    });
    it("signs the input", () => {
      expect(verifySignature({
        publicKey: senderWallet.publicKey,
        data: transaction.outputMap,
        signature: transaction.input.signature
      })).toBe(true);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9uLnRlc3QuanMiXSwibmFtZXMiOlsiVHJhbnNhY3Rpb24iLCJyZXF1aXJlIiwiV2FsbGV0IiwidmVyaWZ5U2lnbmF0dXJlIiwiZGVzY3JpYmUiLCJ0cmFuc2FjdGlvbiIsInNlbmRlcldhbGxldCIsInJlY2VpdmVyIiwiYW1vdW50IiwiYmVmb3JlRWFjaCIsIml0IiwiZXhwZWN0IiwidG9IYXZlUHJvcGVydHkiLCJvdXRwdXRNYXAiLCJ0b0VxdWFsIiwicHVibGljS2V5IiwiYmFsYW5jZSIsImlucHV0IiwiY29uc29sZSIsImxvZyIsImFkZHJlc3MiLCJkYXRhIiwic2lnbmF0dXJlIiwidG9CZSJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsNkJBQUQsQ0FBM0I7O0FBQ0EsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdEI7O0FBQ0EsTUFBTTtBQUFFRSxFQUFBQTtBQUFGLElBQXNCRixPQUFPLENBQUMsZ0JBQUQsQ0FBbkM7O0FBQ0FHLFFBQVEsQ0FBQyxhQUFELEVBQWdCLE1BQU07QUFDNUIsTUFBSUMsV0FBSixFQUFpQkMsWUFBakIsRUFBK0JDLFFBQS9CLEVBQXlDQyxNQUF6QztBQUVBQyxFQUFBQSxVQUFVLENBQUMsTUFBTTtBQUNmSCxJQUFBQSxZQUFZLEdBQUcsSUFBSUosTUFBSixFQUFmO0FBQ0FLLElBQUFBLFFBQVEsR0FBRyxvQkFBWDtBQUNBQyxJQUFBQSxNQUFNLEdBQUcsRUFBVDtBQUNBSCxJQUFBQSxXQUFXLEdBQUcsSUFBSUwsV0FBSixDQUFnQjtBQUFFTSxNQUFBQSxZQUFGO0FBQWdCQyxNQUFBQSxRQUFoQjtBQUEwQkMsTUFBQUE7QUFBMUIsS0FBaEIsQ0FBZDtBQUNELEdBTFMsQ0FBVjtBQU9BRSxFQUFBQSxFQUFFLENBQUMsYUFBRCxFQUFnQixNQUFNO0FBQ3RCQyxJQUFBQSxNQUFNLENBQUNOLFdBQUQsQ0FBTixDQUFvQk8sY0FBcEIsQ0FBbUMsSUFBbkM7QUFDRCxHQUZDLENBQUY7QUFJQVIsRUFBQUEsUUFBUSxDQUFDLFdBQUQsRUFBYyxNQUFNO0FBQzFCTSxJQUFBQSxFQUFFLENBQUMsa0JBQUQsRUFBcUIsTUFBTTtBQUMzQkMsTUFBQUEsTUFBTSxDQUFDTixXQUFELENBQU4sQ0FBb0JPLGNBQXBCLENBQW1DLFdBQW5DO0FBQ0QsS0FGQyxDQUFGO0FBSUFGLElBQUFBLEVBQUUsQ0FBQyw0QkFBRCxFQUErQixNQUFNO0FBQ3JDQyxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1EsU0FBWixDQUFzQk4sUUFBdEIsQ0FBRCxDQUFOLENBQXdDTyxPQUF4QyxDQUFnRE4sTUFBaEQ7QUFDRCxLQUZDLENBQUY7QUFJQUUsSUFBQUEsRUFBRSxDQUFDLDZDQUFELEVBQWdELE1BQU07QUFDdERDLE1BQUFBLE1BQU0sQ0FBQ04sV0FBVyxDQUFDUSxTQUFaLENBQXNCUCxZQUFZLENBQUNTLFNBQW5DLENBQUQsQ0FBTixDQUFzREQsT0FBdEQsQ0FDRVIsWUFBWSxDQUFDVSxPQUFiLEdBQXVCUixNQUR6QjtBQUdELEtBSkMsQ0FBRjtBQUtELEdBZE8sQ0FBUjtBQWdCQUosRUFBQUEsUUFBUSxDQUFDLE9BQUQsRUFBVSxNQUFNO0FBQ3RCTSxJQUFBQSxFQUFFLENBQUMsZ0JBQUQsRUFBbUIsTUFBTTtBQUN6QkMsTUFBQUEsTUFBTSxDQUFDTixXQUFELENBQU4sQ0FBb0JPLGNBQXBCLENBQW1DLE9BQW5DO0FBQ0QsS0FGQyxDQUFGO0FBSUFGLElBQUFBLEVBQUUsQ0FBQyxnQ0FBRCxFQUFtQyxNQUFNO0FBQ3pDQyxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1ksS0FBYixDQUFOLENBQTBCTCxjQUExQixDQUF5QyxXQUF6QztBQUNELEtBRkMsQ0FBRjtBQUlBRixJQUFBQSxFQUFFLENBQUMsaURBQUQsRUFBb0QsTUFBTTtBQUMxRFEsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksVUFBWixFQUF1QmIsWUFBWSxDQUFDVSxPQUFwQztBQUNBTCxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1ksS0FBWixDQUFrQlQsTUFBbkIsQ0FBTixDQUFpQ00sT0FBakMsQ0FBeUNSLFlBQVksQ0FBQ1UsT0FBdEQ7QUFDRCxLQUhDLENBQUY7QUFLQU4sSUFBQUEsRUFBRSxDQUFDLG9EQUFELEVBQXVELE1BQU07QUFDN0RDLE1BQUFBLE1BQU0sQ0FBQ04sV0FBVyxDQUFDWSxLQUFaLENBQWtCRyxPQUFuQixDQUFOLENBQWtDTixPQUFsQyxDQUEwQ1IsWUFBWSxDQUFDUyxTQUF2RDtBQUNELEtBRkMsQ0FBRjtBQUlBTCxJQUFBQSxFQUFFLENBQUMsaUJBQUQsRUFBb0IsTUFBTTtBQUMxQkMsTUFBQUEsTUFBTSxDQUNKUixlQUFlLENBQUM7QUFDZFksUUFBQUEsU0FBUyxFQUFFVCxZQUFZLENBQUNTLFNBRFY7QUFFZE0sUUFBQUEsSUFBSSxFQUFFaEIsV0FBVyxDQUFDUSxTQUZKO0FBR2RTLFFBQUFBLFNBQVMsRUFBRWpCLFdBQVcsQ0FBQ1ksS0FBWixDQUFrQks7QUFIZixPQUFELENBRFgsQ0FBTixDQU1FQyxJQU5GLENBTU8sSUFOUDtBQU9ELEtBUkMsQ0FBRjtBQVNELEdBM0JPLENBQVI7QUE0QkQsQ0ExRE8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRyYW5zYWN0aW9uID0gcmVxdWlyZShcIi4uL3dhbGxldC90cmFuc2FjdGlvbi9pbmRleFwiKTtcclxuY29uc3QgV2FsbGV0ID0gcmVxdWlyZShcIi4uL3dhbGxldC9pbmRleFwiKTtcclxuY29uc3QgeyB2ZXJpZnlTaWduYXR1cmUgfSA9IHJlcXVpcmUoXCIuLi91dGlscy9pbmRleFwiKTtcclxuZGVzY3JpYmUoXCJUcmFuc2FjdGlvblwiLCAoKSA9PiB7XHJcbiAgbGV0IHRyYW5zYWN0aW9uLCBzZW5kZXJXYWxsZXQsIHJlY2VpdmVyLCBhbW91bnQ7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgc2VuZGVyV2FsbGV0ID0gbmV3IFdhbGxldCgpO1xyXG4gICAgcmVjZWl2ZXIgPSBcInJlY2VpdmVyLXB1YmxpY0tleVwiO1xyXG4gICAgYW1vdW50ID0gMjA7XHJcbiAgICB0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih7IHNlbmRlcldhbGxldCwgcmVjZWl2ZXIsIGFtb3VudCB9KTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJoYXMgYW4gYGlkYFwiLCAoKSA9PiB7XHJcbiAgICBleHBlY3QodHJhbnNhY3Rpb24pLnRvSGF2ZVByb3BlcnR5KFwiaWRcIik7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwib3V0cHV0TWFwXCIsICgpID0+IHtcclxuICAgIGl0KFwiaGFzIGFuIG91dHB1dE1hcFwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbikudG9IYXZlUHJvcGVydHkoXCJvdXRwdXRNYXBcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcIm91dHB1dHMgYW1vdW50IG9mIHJlY2VpdmVyXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRyYW5zYWN0aW9uLm91dHB1dE1hcFtyZWNlaXZlcl0pLnRvRXF1YWwoYW1vdW50KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwib3V0cHV0cyB0aGUgcmVtYWluaW5nIGJhbGFuY2Ugb2YgdGhlIHNlbmRlclwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5vdXRwdXRNYXBbc2VuZGVyV2FsbGV0LnB1YmxpY0tleV0pLnRvRXF1YWwoXHJcbiAgICAgICAgc2VuZGVyV2FsbGV0LmJhbGFuY2UgLSBhbW91bnRcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZShcImlucHV0XCIsICgpID0+IHtcclxuICAgIGl0KFwiaGFzIGFuIGBpbnB1dGBcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24pLnRvSGF2ZVByb3BlcnR5KFwiaW5wdXRcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcImhhcyBgdGltZXN0YW1wYCBpbiB0aGUgYGlucHV0YFwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5pbnB1dCkudG9IYXZlUHJvcGVydHkoXCJ0aW1lc3RhbXBcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNldHMgdGhlIGBhbW91bnRgIHRvIHRoZSBgc2VuZGVyV2FsbGV0YCBiYWxhbmNlXCIsICgpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ0JhbGFuY2UgJyxzZW5kZXJXYWxsZXQuYmFsYW5jZSk7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5pbnB1dC5hbW91bnQpLnRvRXF1YWwoc2VuZGVyV2FsbGV0LmJhbGFuY2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzZXRzIHRoZSBgYWRkcmVzc2AgdG8gdGhlIGBzZW5kZXJXYWxsZXRgIHB1YmxpY0tleVwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5pbnB1dC5hZGRyZXNzKS50b0VxdWFsKHNlbmRlcldhbGxldC5wdWJsaWNLZXkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzaWducyB0aGUgaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoXHJcbiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKHtcclxuICAgICAgICAgIHB1YmxpY0tleTogc2VuZGVyV2FsbGV0LnB1YmxpY0tleSxcclxuICAgICAgICAgIGRhdGE6IHRyYW5zYWN0aW9uLm91dHB1dE1hcCxcclxuICAgICAgICAgIHNpZ25hdHVyZTogdHJhbnNhY3Rpb24uaW5wdXQuc2lnbmF0dXJlXHJcbiAgICAgICAgfSlcclxuICAgICAgKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=