782d6b8cbc1c47f2020e49ee2ebf67e8
const {
  GENESIS_DATA
} = require("../config");

const {
  cryptoHash
} = require("../utils");

class Block {
  constructor({
    timestamp,
    previousHash,
    hash,
    data,
    nonce,
    difficulty
  }) {
    this.timestamp = timestamp;
    this.previousHash = previousHash;
    this.hash = hash;
    this.data = data;
    this.nonce = nonce;
    this.difficulty = difficulty;
  }

  static genesis() {
    return new this(GENESIS_DATA);
  }

  static mineBlock({
    lastBlock,
    data
  }) {
    let hash, timestamp;
    const previousHash = lastBlock.hash;
    const {
      difficulty
    } = lastBlock;
    let nonce = 0;

    do {
      nonce++;
      timestamp = Date.now();
      hash = cryptoHash(timestamp, previousHash, difficulty, nonce, data);
    } while (hash.substring(0, difficulty) !== "0".repeat(difficulty));

    return new this({
      timestamp,
      previousHash,
      difficulty,
      nonce,
      hash,
      data
    });
  }

}

module.exports = Block;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJsb2NrLmpzIl0sIm5hbWVzIjpbIkdFTkVTSVNfREFUQSIsInJlcXVpcmUiLCJjcnlwdG9IYXNoIiwiQmxvY2siLCJjb25zdHJ1Y3RvciIsInRpbWVzdGFtcCIsInByZXZpb3VzSGFzaCIsImhhc2giLCJkYXRhIiwibm9uY2UiLCJkaWZmaWN1bHR5IiwiZ2VuZXNpcyIsIm1pbmVCbG9jayIsImxhc3RCbG9jayIsIkRhdGUiLCJub3ciLCJzdWJzdHJpbmciLCJyZXBlYXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBbUJDLE9BQU8sQ0FBQyxXQUFELENBQWhDOztBQUNBLE1BQU07QUFBRUMsRUFBQUE7QUFBRixJQUFpQkQsT0FBTyxDQUFDLFVBQUQsQ0FBOUI7O0FBRUEsTUFBTUUsS0FBTixDQUFZO0FBQ1ZDLEVBQUFBLFdBQVcsQ0FBQztBQUFFQyxJQUFBQSxTQUFGO0FBQWFDLElBQUFBLFlBQWI7QUFBMkJDLElBQUFBLElBQTNCO0FBQWlDQyxJQUFBQSxJQUFqQztBQUF1Q0MsSUFBQUEsS0FBdkM7QUFBOENDLElBQUFBO0FBQTlDLEdBQUQsRUFBNkQ7QUFDdEUsU0FBS0wsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxTQUFLQyxZQUFMLEdBQW9CQSxZQUFwQjtBQUNBLFNBQUtDLElBQUwsR0FBWUEsSUFBWjtBQUNBLFNBQUtDLElBQUwsR0FBWUEsSUFBWjtBQUNBLFNBQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLFNBQUtDLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0Q7O0FBRUQsU0FBT0MsT0FBUCxHQUFpQjtBQUNmLFdBQU8sSUFBSSxJQUFKLENBQVNYLFlBQVQsQ0FBUDtBQUNEOztBQUVELFNBQU9ZLFNBQVAsQ0FBaUI7QUFBRUMsSUFBQUEsU0FBRjtBQUFhTCxJQUFBQTtBQUFiLEdBQWpCLEVBQXNDO0FBQ3BDLFFBQUlELElBQUosRUFBVUYsU0FBVjtBQUNBLFVBQU1DLFlBQVksR0FBR08sU0FBUyxDQUFDTixJQUEvQjtBQUNBLFVBQU07QUFBRUcsTUFBQUE7QUFBRixRQUFpQkcsU0FBdkI7QUFDQSxRQUFJSixLQUFLLEdBQUcsQ0FBWjs7QUFDQSxPQUFHO0FBQ0RBLE1BQUFBLEtBQUs7QUFDTEosTUFBQUEsU0FBUyxHQUFHUyxJQUFJLENBQUNDLEdBQUwsRUFBWjtBQUNBUixNQUFBQSxJQUFJLEdBQUdMLFVBQVUsQ0FBQ0csU0FBRCxFQUFZQyxZQUFaLEVBQTBCSSxVQUExQixFQUFzQ0QsS0FBdEMsRUFBNkNELElBQTdDLENBQWpCO0FBQ0QsS0FKRCxRQUlTRCxJQUFJLENBQUNTLFNBQUwsQ0FBZSxDQUFmLEVBQWtCTixVQUFsQixNQUFrQyxJQUFJTyxNQUFKLENBQVdQLFVBQVgsQ0FKM0M7O0FBTUEsV0FBTyxJQUFJLElBQUosQ0FBUztBQUNkTCxNQUFBQSxTQURjO0FBRWRDLE1BQUFBLFlBRmM7QUFHZEksTUFBQUEsVUFIYztBQUlkRCxNQUFBQSxLQUpjO0FBS2RGLE1BQUFBLElBTGM7QUFNZEMsTUFBQUE7QUFOYyxLQUFULENBQVA7QUFRRDs7QUFqQ1M7O0FBb0NaVSxNQUFNLENBQUNDLE9BQVAsR0FBaUJoQixLQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgR0VORVNJU19EQVRBIH0gPSByZXF1aXJlKFwiLi4vY29uZmlnXCIpO1xyXG5jb25zdCB7IGNyeXB0b0hhc2ggfSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcclxuXHJcbmNsYXNzIEJsb2NrIHtcclxuICBjb25zdHJ1Y3Rvcih7IHRpbWVzdGFtcCwgcHJldmlvdXNIYXNoLCBoYXNoLCBkYXRhLCBub25jZSwgZGlmZmljdWx0eSB9KSB7XHJcbiAgICB0aGlzLnRpbWVzdGFtcCA9IHRpbWVzdGFtcDtcclxuICAgIHRoaXMucHJldmlvdXNIYXNoID0gcHJldmlvdXNIYXNoO1xyXG4gICAgdGhpcy5oYXNoID0gaGFzaDtcclxuICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLm5vbmNlID0gbm9uY2U7XHJcbiAgICB0aGlzLmRpZmZpY3VsdHkgPSBkaWZmaWN1bHR5O1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdlbmVzaXMoKSB7XHJcbiAgICByZXR1cm4gbmV3IHRoaXMoR0VORVNJU19EQVRBKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBtaW5lQmxvY2soeyBsYXN0QmxvY2ssIGRhdGEgfSkge1xyXG4gICAgbGV0IGhhc2gsIHRpbWVzdGFtcDtcclxuICAgIGNvbnN0IHByZXZpb3VzSGFzaCA9IGxhc3RCbG9jay5oYXNoO1xyXG4gICAgY29uc3QgeyBkaWZmaWN1bHR5IH0gPSBsYXN0QmxvY2s7XHJcbiAgICBsZXQgbm9uY2UgPSAwO1xyXG4gICAgZG8ge1xyXG4gICAgICBub25jZSsrO1xyXG4gICAgICB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgICBoYXNoID0gY3J5cHRvSGFzaCh0aW1lc3RhbXAsIHByZXZpb3VzSGFzaCwgZGlmZmljdWx0eSwgbm9uY2UsIGRhdGEpO1xyXG4gICAgfSB3aGlsZSAoaGFzaC5zdWJzdHJpbmcoMCwgZGlmZmljdWx0eSkgIT09IFwiMFwiLnJlcGVhdChkaWZmaWN1bHR5KSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyB0aGlzKHtcclxuICAgICAgdGltZXN0YW1wLFxyXG4gICAgICBwcmV2aW91c0hhc2gsXHJcbiAgICAgIGRpZmZpY3VsdHksXHJcbiAgICAgIG5vbmNlLFxyXG4gICAgICBoYXNoLFxyXG4gICAgICBkYXRhXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQmxvY2s7XHJcbiJdfQ==