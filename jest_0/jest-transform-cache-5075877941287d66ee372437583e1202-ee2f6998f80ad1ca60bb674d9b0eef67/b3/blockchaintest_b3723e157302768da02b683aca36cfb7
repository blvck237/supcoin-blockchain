1ea4121fbdbc9290f2c376fdcd94f895
const Blockchain = require("../blockchain/index");

const Block = require("../blockchain/block");

describe("Blockchain", () => {
  let blockchain, newChain, originalChain;
  beforeEach(() => {
    blockchain = new Blockchain();
    newChain = new Blockchain();
    originalChain = blockchain.chain;
  });
  it("constains a `chain` array instance", () => {
    expect(blockchain.chain instanceof Array).toBe(true);
  });
  it("starts with the genesis block", () => {
    expect(blockchain.chain[0]).toEqual(Block.genesis());
  });
  it("adds a new block to chain", () => {
    const newData = "foo bar";
    blockchain.addBlock({
      data: newData
    });
    expect(blockchain.chain[blockchain.chain.length - 1].data).toEqual(newData);
  });
  describe("isValidChain()", () => {
    describe("when chain does not start with genesis block", () => {
      it("returns false", () => {
        blockchain.chain[0] = {
          data: "fake-genesis"
        };
        expect(Blockchain.isValidChain(blockchain.chain)).toBe(false);
      });
    });
    describe("when chain starts with genesis block and has multiple blocks", () => {
      beforeEach(() => {
        blockchain.addBlock({
          data: "Dogs"
        });
        blockchain.addBlock({
          data: "Cats"
        });
        blockchain.addBlock({
          data: "Pigs"
        });
      });
      describe("and the previousHash has changed", () => {
        it("returns false", () => {
          blockchain.chain[2].previousHash = "pigs-hash";
          expect(Blockchain.isValidChain(blockchain.chain)).toBe(false);
        });
        describe("and chain contains block with an invalid field", () => {
          it("returns false", () => {
            blockchain.chain[2].data = "bad-pigs";
            expect(Blockchain.isValidChain(blockchain.chain)).toBe(false);
          });
        });
        describe("and chain does not contains an invalid block", () => {
          it("returns true", () => {
            expect(Blockchain.isValidChain(blockchain.chain)).toBe(true);
          });
        });
      });
    });
  });
  describe("replaceChain()", () => {
    let errorMock, logMock;
    beforeEach(() => {
      errorMock = jest.fn();
      logMock = jest.fn();
      global.console.error = errorMock;
      global.console.log = logMock;
    });
    describe("when the new chain is not longer", () => {
      beforeEach(() => {
        newChain.chain[0] = {
          new: "new-chain"
        };
        blockchain.replaceChain(newChain.chain);
      });
      it("it does not replace the chain ", () => {
        expect(blockchain.chain).toEqual(originalChain);
      });
      it("logs an error", () => {
        expect(errorMock).toHaveBeenCalled();
      });
    });
    describe("when the new chain is longer", () => {
      beforeEach(() => {
        newChain.addBlock({
          data: "Dogs"
        });
        newChain.addBlock({
          data: "Cats"
        });
        newChain.addBlock({
          data: "Pigs"
        });
      });
      describe("and the chain is invalid", () => {
        beforeEach(() => {
          newChain.chain[2].hash = "fake-hash";
          blockchain.replaceChain(newChain.chain);
        });
        it("does not replace the chain", () => {
          expect(blockchain.chain).toEqual(originalChain);
        });
        it("logs an error", () => {
          expect(errorMock).toHaveBeenCalled();
        });
      });
      describe("and the chain is valid", () => {
        beforeEach(() => {
          blockchain.replaceChain(newChain.chain);
        });
        it("replaces the chain", () => {
          expect(blockchain.chain).toEqual(newChain.chain);
        });
        it("logs about the chain replacement", () => {
          expect(logMock).toHaveBeenCalled();
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJsb2NrY2hhaW4udGVzdC5qcyJdLCJuYW1lcyI6WyJCbG9ja2NoYWluIiwicmVxdWlyZSIsIkJsb2NrIiwiZGVzY3JpYmUiLCJibG9ja2NoYWluIiwibmV3Q2hhaW4iLCJvcmlnaW5hbENoYWluIiwiYmVmb3JlRWFjaCIsImNoYWluIiwiaXQiLCJleHBlY3QiLCJBcnJheSIsInRvQmUiLCJ0b0VxdWFsIiwiZ2VuZXNpcyIsIm5ld0RhdGEiLCJhZGRCbG9jayIsImRhdGEiLCJsZW5ndGgiLCJpc1ZhbGlkQ2hhaW4iLCJwcmV2aW91c0hhc2giLCJlcnJvck1vY2siLCJsb2dNb2NrIiwiamVzdCIsImZuIiwiZ2xvYmFsIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwibmV3IiwicmVwbGFjZUNoYWluIiwidG9IYXZlQmVlbkNhbGxlZCIsImhhc2giXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFVBQVUsR0FBR0MsT0FBTyxDQUFDLHFCQUFELENBQTFCOztBQUNBLE1BQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLHFCQUFELENBQXJCOztBQUNBRSxRQUFRLENBQUMsWUFBRCxFQUFlLE1BQU07QUFDM0IsTUFBSUMsVUFBSixFQUFnQkMsUUFBaEIsRUFBMEJDLGFBQTFCO0FBRUFDLEVBQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2ZILElBQUFBLFVBQVUsR0FBRyxJQUFJSixVQUFKLEVBQWI7QUFDQUssSUFBQUEsUUFBUSxHQUFHLElBQUlMLFVBQUosRUFBWDtBQUNBTSxJQUFBQSxhQUFhLEdBQUdGLFVBQVUsQ0FBQ0ksS0FBM0I7QUFDRCxHQUpTLENBQVY7QUFNQUMsRUFBQUEsRUFBRSxDQUFDLG9DQUFELEVBQXVDLE1BQU07QUFDN0NDLElBQUFBLE1BQU0sQ0FBQ04sVUFBVSxDQUFDSSxLQUFYLFlBQTRCRyxLQUE3QixDQUFOLENBQTBDQyxJQUExQyxDQUErQyxJQUEvQztBQUNELEdBRkMsQ0FBRjtBQUlBSCxFQUFBQSxFQUFFLENBQUMsK0JBQUQsRUFBa0MsTUFBTTtB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Q0MsVUFBQUEsTUFBTSxDQUFDWSxPQUFELENBQU4sQ0FBZ0JTLGdCQUFoQjtBQUNELFNBRkMsQ0FBRjtBQUdELE9BWk8sQ0FBUjtBQWFELEtBbkNPLENBQVI7QUFvQ0QsR0E5RE8sQ0FBUjtBQStERCxDQTlITyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQmxvY2tjaGFpbiA9IHJlcXVpcmUoXCIuLi9ibG9ja2NoYWluL2luZGV4XCIpO1xyXG5jb25zdCBCbG9jayA9IHJlcXVpcmUoXCIuLi9ibG9ja2NoYWluL2Jsb2NrXCIpO1xyXG5kZXNjcmliZShcIkJsb2NrY2hhaW5cIiwgKCkgPT4ge1xyXG4gIGxldCBibG9ja2NoYWluLCBuZXdDaGFpbiwgb3JpZ2luYWxDaGFpbjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBibG9ja2NoYWluID0gbmV3IEJsb2NrY2hhaW4oKTtcclxuICAgIG5ld0NoYWluID0gbmV3IEJsb2NrY2hhaW4oKTtcclxuICAgIG9yaWdpbmFsQ2hhaW4gPSBibG9ja2NoYWluLmNoYWluO1xyXG4gIH0pO1xyXG5cclxuICBpdChcImNvbnN0YWlucyBhIGBjaGFpbmAgYXJyYXkgaW5zdGFuY2VcIiwgKCkgPT4ge1xyXG4gICAgZXhwZWN0KGJsb2NrY2hhaW4uY2hhaW4gaW5zdGFuY2VvZiBBcnJheSkudG9CZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJzdGFydHMgd2l0aCB0aGUgZ2VuZXNpcyBibG9ja1wiLCAoKSA9PiB7XHJcbiAgICBleHBlY3QoYmxvY2tjaGFpbi5jaGFpblswXSkudG9FcXVhbChCbG9jay5nZW5lc2lzKCkpO1xyXG4gIH0pO1xyXG5cclxuICBpdChcImFkZHMgYSBuZXcgYmxvY2sgdG8gY2hhaW5cIiwgKCkgPT4ge1xyXG4gICAgY29uc3QgbmV3RGF0YSA9IFwiZm9vIGJhclwiO1xyXG4gICAgYmxvY2tjaGFpbi5hZGRCbG9jayh7IGRhdGE6IG5ld0RhdGEgfSk7XHJcblxyXG4gICAgZXhwZWN0KGJsb2NrY2hhaW4uY2hhaW5bYmxvY2tjaGFpbi5jaGFpbi5sZW5ndGggLSAxXS5kYXRhKS50b0VxdWFsKG5ld0RhdGEpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZShcImlzVmFsaWRDaGFpbigpXCIsICgpID0+IHtcclxuICAgIGRlc2NyaWJlKFwid2hlbiBjaGFpbiBkb2VzIG5vdCBzdGFydCB3aXRoIGdlbmVzaXMgYmxvY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpdChcInJldHVybnMgZmFsc2VcIiwgKCkgPT4ge1xyXG4gICAgICAgIGJsb2NrY2hhaW4uY2hhaW5bMF0gPSB7IGRhdGE6IFwiZmFrZS1nZW5lc2lzXCIgfTtcclxuXHJcbiAgICAgICAgZXhwZWN0KEJsb2NrY2hhaW4uaXNWYWxpZENoYWluKGJsb2NrY2hhaW4uY2hhaW4pKS50b0JlKGZhbHNlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZShcIndoZW4gY2hhaW4gc3RhcnRzIHdpdGggZ2VuZXNpcyBibG9jayBhbmQgaGFzIG11bHRpcGxlIGJsb2Nrc1wiLCAoKSA9PiB7XHJcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIGJsb2NrY2hhaW4uYWRkQmxvY2soeyBkYXRhOiBcIkRvZ3NcIiB9KTtcclxuICAgICAgICBibG9ja2NoYWluLmFkZEJsb2NrKHsgZGF0YTogXCJDYXRzXCIgfSk7XHJcbiAgICAgICAgYmxvY2tjaGFpbi5hZGRCbG9jayh7IGRhdGE6IFwiUGlnc1wiIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIHByZXZpb3VzSGFzaCBoYXMgY2hhbmdlZFwiLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoXCJyZXR1cm5zIGZhbHNlXCIsICgpID0+IHtcclxuICAgICAgICAgIGJsb2NrY2hhaW4uY2hhaW5bMl0ucHJldmlvdXNIYXNoID0gXCJwaWdzLWhhc2hcIjtcclxuXHJcbiAgICAgICAgICBleHBlY3QoQmxvY2tjaGFpbi5pc1ZhbGlkQ2hhaW4oYmxvY2tjaGFpbi5jaGFpbikpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkZXNjcmliZShcImFuZCBjaGFpbiBjb250YWlucyBibG9jayB3aXRoIGFuIGludmFsaWQgZmllbGRcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgaXQoXCJyZXR1cm5zIGZhbHNlXCIsICgpID0+IHtcclxuICAgICAgICAgICAgYmxvY2tjaGFpbi5jaGFpblsyXS5kYXRhID0gXCJiYWQtcGlnc1wiO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KEJsb2NrY2hhaW4uaXNWYWxpZENoYWluKGJsb2NrY2hhaW4uY2hhaW4pKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkZXNjcmliZShcImFuZCBjaGFpbiBkb2VzIG5vdCBjb250YWlucyBhbiBpbnZhbGlkIGJsb2NrXCIsICgpID0+IHtcclxuICAgICAgICAgIGl0KFwicmV0dXJucyB0cnVlXCIsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KEJsb2NrY2hhaW4uaXNWYWxpZENoYWluKGJsb2NrY2hhaW4uY2hhaW4pKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwicmVwbGFjZUNoYWluKClcIiwgKCkgPT4ge1xyXG4gICAgbGV0IGVycm9yTW9jaywgbG9nTW9jaztcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgZXJyb3JNb2NrID0gamVzdC5mbigpO1xyXG4gICAgICBsb2dNb2NrID0gamVzdC5mbigpO1xyXG5cclxuICAgICAgZ2xvYmFsLmNvbnNvbGUuZXJyb3IgPSBlcnJvck1vY2s7XHJcbiAgICAgIGdsb2JhbC5jb25zb2xlLmxvZyA9IGxvZ01vY2s7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZShcIndoZW4gdGhlIG5ldyBjaGFpbiBpcyBub3QgbG9uZ2VyXCIsICgpID0+IHtcclxuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgbmV3Q2hhaW4uY2hhaW5bMF0gPSB7IG5ldzogXCJuZXctY2hhaW5cIiB9O1xyXG4gICAgICAgIGJsb2NrY2hhaW4ucmVwbGFjZUNoYWluKG5ld0NoYWluLmNoYWluKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChcIml0IGRvZXMgbm90IHJlcGxhY2UgdGhlIGNoYWluIFwiLCAoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KGJsb2NrY2hhaW4uY2hhaW4pLnRvRXF1YWwob3JpZ2luYWxDaGFpbik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoXCJsb2dzIGFuIGVycm9yXCIsICgpID0+IHtcclxuICAgICAgICBleHBlY3QoZXJyb3JNb2NrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJ3aGVuIHRoZSBuZXcgY2hhaW4gaXMgbG9uZ2VyXCIsICgpID0+IHtcclxuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgbmV3Q2hhaW4uYWRkQmxvY2soeyBkYXRhOiBcIkRvZ3NcIiB9KTtcclxuICAgICAgICBuZXdDaGFpbi5hZGRCbG9jayh7IGRhdGE6IFwiQ2F0c1wiIH0pO1xyXG4gICAgICAgIG5ld0NoYWluLmFkZEJsb2NrKHsgZGF0YTogXCJQaWdzXCIgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIGNoYWluIGlzIGludmFsaWRcIiwgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgbmV3Q2hhaW4uY2hhaW5bMl0uaGFzaCA9IFwiZmFrZS1oYXNoXCI7XHJcbiAgICAgICAgICBibG9ja2NoYWluLnJlcGxhY2VDaGFpbihuZXdDaGFpbi5jaGFpbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KFwiZG9lcyBub3QgcmVwbGFjZSB0aGUgY2hhaW5cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgZXhwZWN0KGJsb2NrY2hhaW4uY2hhaW4pLnRvRXF1YWwob3JpZ2luYWxDaGFpbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KFwibG9ncyBhbiBlcnJvclwiLCAoKSA9PiB7XHJcbiAgICAgICAgICBleHBlY3QoZXJyb3JNb2NrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIGNoYWluIGlzIHZhbGlkXCIsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgIGJsb2NrY2hhaW4ucmVwbGFjZUNoYWluKG5ld0NoYWluLmNoYWluKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJyZXBsYWNlcyB0aGUgY2hhaW5cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgZXhwZWN0KGJsb2NrY2hhaW4uY2hhaW4pLnRvRXF1YWwobmV3Q2hhaW4uY2hhaW4pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdChcImxvZ3MgYWJvdXQgdGhlIGNoYWluIHJlcGxhY2VtZW50XCIsICgpID0+IHtcclxuICAgICAgICAgIGV4cGVjdChsb2dNb2NrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=