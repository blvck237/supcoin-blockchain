1d180b299b2e18d647173868779b95d7
const Transaction = require("../wallet/transaction/index");

const Wallet = require("../wallet/index");

const {
  verifySignature
} = require("../utils");

describe("Transaction", () => {
  let transaction, senderWallet, receiver, amount;
  beforeEach(() => {
    senderWallet = new Wallet();
    receiver = "receiver-publicKey";
    amount = 20;
    transaction = new Transaction({
      senderWallet,
      receiver,
      amount
    });
  });
  it("has an `id`", () => {
    expect(transaction).toHaveProperty("id");
  });
  describe("outputMap", () => {
    it("has an outputMap", () => {
      expect(transaction).toHaveProperty("outputMap");
    });
    it("outputs amount of receiver", () => {
      expect(transaction.outputMap[receiver]).toEqual(amount);
    });
    it("outputs the remaining balance of the sender", () => {
      expect(transaction.outputMap[senderWallet.publicKey]).toEqual(senderWallet.balance - amount);
    });
  });
  describe("input", () => {
    it("has an `input`", () => {
      expect(transaction).toHaveProperty("input");
    });
    it("has `timestamp` in the `input`", () => {
      expect(transaction.input).toHaveProperty("timestamp");
    });
    it("sets the `amount` to the `senderWallet` balance", () => {
      expect(transaction.input.amount).toEqual(senderWallet.balance);
    });
    it("sets the `address` to the `senderWallet` publicKey", () => {
      expect(transaction.input.address).toEqual(senderWallet.publicKey);
    });
    it("signs the input", () => {
      expect(verifySignature({
        publicKey: senderWallet.publicKey,
        data: transaction.outputMap,
        signature: transaction.input.signature
      })).toBe(true);
    });
  });
  describe("valid transaction", () => {
    let errorMock;
    beforeEach(() => {
      errorMock = jest.fn();
      global.console.error = errorMock;
    });
    describe("when transaction is valid", () => {
      it("returns true", () => {
        expect(Transaction.validateTransaction(transaction)).toBe(true);
      });
    });
    describe("when transaction is invalid", () => {
      describe("and the transaction outputmap value is invalid", () => {
        it("returns false and logs an error", () => {
          transaction.outputMap[senderWallet.publicKey] = 999999;
          expect(Transaction.validateTransaction(transaction)).toBe(false); //   expect(errorMock).toHaveBeenCalled();
        });
      });
      describe("and the transaction input signature is invalid", () => {
        it("returns false and logs an error", () => {
          transaction.input.signature = new Wallet().sign("data");
          expect(Transaction.validateTransaction(transaction)).toBe(false); //   expect(errorMock).toHaveBeenCalled();
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9uLnRlc3QuanMiXSwibmFtZXMiOlsiVHJhbnNhY3Rpb24iLCJyZXF1aXJlIiwiV2FsbGV0IiwidmVyaWZ5U2lnbmF0dXJlIiwiZGVzY3JpYmUiLCJ0cmFuc2FjdGlvbiIsInNlbmRlcldhbGxldCIsInJlY2VpdmVyIiwiYW1vdW50IiwiYmVmb3JlRWFjaCIsIml0IiwiZXhwZWN0IiwidG9IYXZlUHJvcGVydHkiLCJvdXRwdXRNYXAiLCJ0b0VxdWFsIiwicHVibGljS2V5IiwiYmFsYW5jZSIsImlucHV0IiwiYWRkcmVzcyIsImRhdGEiLCJzaWduYXR1cmUiLCJ0b0JlIiwiZXJyb3JNb2NrIiwiamVzdCIsImZuIiwiZ2xvYmFsIiwiY29uc29sZSIsImVycm9yIiwidmFsaWRhdGVUcmFuc2FjdGlvbiIsInNpZ24iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFdBQVcsR0FBR0MsT0FBTyxDQUFDLDZCQUFELENBQTNCOztBQUNBLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGlCQUFELENBQXRCOztBQUNBLE1BQU07QUFBRUUsRUFBQUE7QUFBRixJQUFzQkYsT0FBTyxDQUFDLFVBQUQsQ0FBbkM7O0FBQ0FHLFFBQVEsQ0FBQyxhQUFELEVBQWdCLE1BQU07QUFDNUIsTUFBSUMsV0FBSixFQUFpQkMsWUFBakIsRUFBK0JDLFFBQS9CLEVBQXlDQyxNQUF6QztBQUVBQyxFQUFBQSxVQUFVLENBQUMsTUFBTTtBQUNmSCxJQUFBQSxZQUFZLEdBQUcsSUFBSUosTUFBSixFQUFmO0FBQ0FLLElBQUFBLFFBQVEsR0FBRyxvQkFBWDtBQUNBQyxJQUFBQSxNQUFNLEdBQUcsRUFBVDtBQUNBSCxJQUFBQSxXQUFXLEdBQUcsSUFBSUwsV0FBSixDQUFnQjtBQUFFTSxNQUFBQSxZQUFGO0FBQWdCQyxNQUFBQSxRQUFoQjtBQUEwQkMsTUFBQUE7QUFBMUIsS0FBaEIsQ0FBZDtBQUNELEdBTFMsQ0FBVjtBQU9BRSxFQUFBQSxFQUFFLENBQUMsYUFBRCxFQUFnQixNQUFNO0FBQ3RCQyxJQUFBQSxNQUFNLENBQUNOLFdBQUQsQ0FBTixDQUFvQk8sY0FBcEIsQ0FBbUMsSUFBbkM7QUFDRCxHQUZDLENBQUY7QUFJQVIsRUFBQUEsUUFBUSxDQUFDLFdBQUQsRUFBYyxNQUFNO0FBQzFCTSxJQUFBQSxFQUFFLENBQUMsa0JBQUQsRUFBcUIsTUFBTTtBQUMzQkMsTUFBQUEsTUFBTSxDQUFDTixXQUFELENBQU4sQ0FBb0JPLGNBQXBCLENBQW1DLFdBQW5DO0FBQ0QsS0FGQyxDQUFGO0FBSUFGLElBQUFBLEVBQUUsQ0FBQyw0QkFBRCxFQUErQixNQUFNO0FBQ3JDQyxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1EsU0FBWixDQUFzQk4sUUFBdEIsQ0FBRCxDQUFOLENBQXdDTyxPQUF4QyxDQUFnRE4sTUFBaEQ7QUFDRCxLQUZDLENBQUY7QUFJQUUsSUFBQUEsRUFBRSxDQUFDLDZDQUFELEVBQWdELE1BQU07QUFDdERDLE1BQUFBLE1BQU0sQ0FBQ04sV0FBVyxDQUFDUSxTQUFaLENBQXNCUCxZQUFZLENBQUNTLFNBQW5DLENBQUQsQ0FBTixDQUFzREQsT0FBdEQsQ0FDRVIsWUFBWSxDQUFDVSxPQUFiLEdBQXVCUixNQUR6QjtBQUdELEtBSkMsQ0FBRjtBQUtELEdBZE8sQ0FBUjtBQWdCQUosRUFBQUEsUUFBUSxDQUFDLE9BQUQsRUFBVSxNQUFNO0FBQ3RCTSxJQUFBQSxFQUFFLENBQUMsZ0JBQUQsRUFBbUIsTUFBTTtBQUN6QkMsTUFBQUEsTUFBTSxDQUFDTixXQUFELENBQU4sQ0FBb0JPLGNBQXBCLENBQW1DLE9BQW5DO0FBQ0QsS0FGQyxDQUFGO0FBSUFGLElBQUFBLEVBQUUsQ0FBQyxnQ0FBRCxFQUFtQyxNQUFNO0FBQ3pDQyxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1ksS0FBYixDQUFOLENBQTBCTCxjQUExQixDQUF5QyxXQUF6QztBQUNELEtBRkMsQ0FBRjtBQUlBRixJQUFBQSxFQUFFLENBQUMsaURBQUQsRUFBb0QsTUFBTTtBQUMxREMsTUFBQUEsTUFBTSxDQUFDTixXQUFXLENBQUNZLEtBQVosQ0FBa0JULE1BQW5CLENBQU4sQ0FBaUNNLE9BQWpDLENBQXlDUixZQUFZLENBQUNVLE9BQXREO0FBQ0QsS0FGQyxDQUFGO0FBSUFOLElBQUFBLEVBQUUsQ0FBQyxvREFBRCxFQUF1RCxNQUFNO0FBQzdEQyxNQUFBQSxNQUFNLENBQUNOLFdBQVcsQ0FBQ1ksS0FBWixDQUFrQkMsT0FBbkIsQ0FBTixDQUFrQ0osT0FBbEMsQ0FBMENSLFlBQVksQ0FBQ1MsU0FBdkQ7QUFDRCxLQUZDLENBQUY7QUFJQUwsSUFBQUEsRUFBRSxDQUFDLGlCQUFELEVBQW9CLE1BQU07QUFDMUJDLE1BQUFBLE1BQU0sQ0FDSlIsZUFBZSxDQUFDO0FBQ2RZLFFBQUFBLFNBQVMsRUFBRVQsWUFBWSxDQUFDUyxTQURWO0FBRWRJLFFBQUFBLElBQUksRUFBRWQsV0FBVyxDQUFDUSxTQUZKO0FBR2RPLFFBQUFBLFNBQVMsRUFBRWYsV0FBVyxDQUFDWSxLQUFaLENBQWtCRztBQUhmLE9BQUQsQ0FEWCxDQUFOLENBTUVDLElBTkYsQ0FNTyxJQU5QO0FBT0QsS0FSQyxDQUFGO0FBU0QsR0ExQk8sQ0FBUjtBQTRCQWpCLEVBQUFBLFFBQVEsQ0FBQyxtQkFBRCxFQUFzQixNQUFNO0FBQ2xDLFFBQUlrQixTQUFKO0FBRUFiLElBQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2ZhLE1BQUFBLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxFQUFMLEVBQVo7QUFFQUMsTUFBQUEsTUFBTSxDQUFDQyxPQUFQLENBQWVDLEtBQWYsR0FBdUJMLFNBQXZCO0FBQ0QsS0FKUyxDQUFWO0FBTUFsQixJQUFBQSxRQUFRLENBQUMsMkJBQUQsRUFBOEIsTUFBTTtBQUMxQ00sTUFBQUEsRUFBRSxDQUFDLGNBQUQsRUFBaUIsTUFBTTtBQUN2QkMsUUFBQUEsTUFBTSxDQUFDWCxXQUFXLENBQUM0QixtQkFBWixDQUFnQ3ZCLFdBQWhDLENBQUQsQ0FBTixDQUFxRGdCLElBQXJELENBQTBELElBQTFEO0FBQ0QsT0FGQyxDQUFGO0FBR0QsS0FKTyxDQUFSO0FBTUFqQixJQUFBQSxRQUFRLENBQUMsNkJBQUQsRUFBZ0MsTUFBTTtBQUM1Q0EsTUFBQUEsUUFBUSxDQUFDLGdEQUFELEVBQW1ELE1BQU07QUFDL0RNLFFBQUFBLEVBQUUsQ0FBQyxpQ0FBRCxFQUFvQyxNQUFNO0FBQzFDTCxVQUFBQSxXQUFXLENBQUNRLFNBQVosQ0FBc0JQLFlBQVksQ0FBQ1MsU0FBbkMsSUFBZ0QsTUFBaEQ7QUFDQUosVUFBQUEsTUFBTSxDQUFDWCxXQUFXLENBQUM0QixtQkFBWixDQUFnQ3ZCLFdBQWhDLENBQUQsQ0FBTixDQUFxRGdCLElBQXJELENBQTBELEtBQTFELEVBRjBDLENBRzVDO0FBQ0MsU0FKQyxDQUFGO0FBS0QsT0FOTyxDQUFSO0FBUUFqQixNQUFBQSxRQUFRLENBQUMsZ0RBQUQsRUFBbUQsTUFBTTtBQUMvRE0sUUFBQUEsRUFBRSxDQUFDLGlDQUFELEVBQW9DLE1BQU07QUFDMUNMLFVBQUFBLFdBQVcsQ0FBQ1ksS0FBWixDQUFrQkcsU0FBbEIsR0FBOEIsSUFBSWxCLE1BQUosR0FBYTJCLElBQWIsQ0FBa0IsTUFBbEIsQ0FBOUI7QUFDQWxCLFVBQUFBLE1BQU0sQ0FBQ1gsV0FBVyxDQUFDNEIsbUJBQVosQ0FBZ0N2QixXQUFoQyxDQUFELENBQU4sQ0FBcURnQixJQUFyRCxDQUEwRCxLQUExRCxFQUYwQyxDQUc1QztBQUNDLFNBSkMsQ0FBRjtBQUtELE9BTk8sQ0FBUjtBQU9ELEtBaEJPLENBQVI7QUFpQkQsR0FoQ08sQ0FBUjtBQWlDRCxDQTNGTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVHJhbnNhY3Rpb24gPSByZXF1aXJlKFwiLi4vd2FsbGV0L3RyYW5zYWN0aW9uL2luZGV4XCIpO1xyXG5jb25zdCBXYWxsZXQgPSByZXF1aXJlKFwiLi4vd2FsbGV0L2luZGV4XCIpO1xyXG5jb25zdCB7IHZlcmlmeVNpZ25hdHVyZSB9ID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xyXG5kZXNjcmliZShcIlRyYW5zYWN0aW9uXCIsICgpID0+IHtcclxuICBsZXQgdHJhbnNhY3Rpb24sIHNlbmRlcldhbGxldCwgcmVjZWl2ZXIsIGFtb3VudDtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBzZW5kZXJXYWxsZXQgPSBuZXcgV2FsbGV0KCk7XHJcbiAgICByZWNlaXZlciA9IFwicmVjZWl2ZXItcHVibGljS2V5XCI7XHJcbiAgICBhbW91bnQgPSAyMDtcclxuICAgIHRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHsgc2VuZGVyV2FsbGV0LCByZWNlaXZlciwgYW1vdW50IH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdChcImhhcyBhbiBgaWRgXCIsICgpID0+IHtcclxuICAgIGV4cGVjdCh0cmFuc2FjdGlvbikudG9IYXZlUHJvcGVydHkoXCJpZFwiKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJvdXRwdXRNYXBcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJoYXMgYW4gb3V0cHV0TWFwXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRyYW5zYWN0aW9uKS50b0hhdmVQcm9wZXJ0eShcIm91dHB1dE1hcFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwib3V0cHV0cyBhbW91bnQgb2YgcmVjZWl2ZXJcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24ub3V0cHV0TWFwW3JlY2VpdmVyXSkudG9FcXVhbChhbW91bnQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJvdXRwdXRzIHRoZSByZW1haW5pbmcgYmFsYW5jZSBvZiB0aGUgc2VuZGVyXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRyYW5zYWN0aW9uLm91dHB1dE1hcFtzZW5kZXJXYWxsZXQucHVibGljS2V5XSkudG9FcXVhbChcclxuICAgICAgICBzZW5kZXJXYWxsZXQuYmFsYW5jZSAtIGFtb3VudFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJoYXMgYW4gYGlucHV0YFwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbikudG9IYXZlUHJvcGVydHkoXCJpbnB1dFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwiaGFzIGB0aW1lc3RhbXBgIGluIHRoZSBgaW5wdXRgXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRyYW5zYWN0aW9uLmlucHV0KS50b0hhdmVQcm9wZXJ0eShcInRpbWVzdGFtcFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwic2V0cyB0aGUgYGFtb3VudGAgdG8gdGhlIGBzZW5kZXJXYWxsZXRgIGJhbGFuY2VcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24uaW5wdXQuYW1vdW50KS50b0VxdWFsKHNlbmRlcldhbGxldC5iYWxhbmNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwic2V0cyB0aGUgYGFkZHJlc3NgIHRvIHRoZSBgc2VuZGVyV2FsbGV0YCBwdWJsaWNLZXlcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24uaW5wdXQuYWRkcmVzcykudG9FcXVhbChzZW5kZXJXYWxsZXQucHVibGljS2V5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwic2lnbnMgdGhlIGlucHV0XCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KFxyXG4gICAgICAgIHZlcmlmeVNpZ25hdHVyZSh7XHJcbiAgICAgICAgICBwdWJsaWNLZXk6IHNlbmRlcldhbGxldC5wdWJsaWNLZXksXHJcbiAgICAgICAgICBkYXRhOiB0cmFuc2FjdGlvbi5vdXRwdXRNYXAsXHJcbiAgICAgICAgICBzaWduYXR1cmU6IHRyYW5zYWN0aW9uLmlucHV0LnNpZ25hdHVyZVxyXG4gICAgICAgIH0pXHJcbiAgICAgICkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZShcInZhbGlkIHRyYW5zYWN0aW9uXCIsICgpID0+IHtcclxuICAgIGxldCBlcnJvck1vY2s7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIGVycm9yTW9jayA9IGplc3QuZm4oKTtcclxuXHJcbiAgICAgIGdsb2JhbC5jb25zb2xlLmVycm9yID0gZXJyb3JNb2NrO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJ3aGVuIHRyYW5zYWN0aW9uIGlzIHZhbGlkXCIsICgpID0+IHtcclxuICAgICAgaXQoXCJyZXR1cm5zIHRydWVcIiwgKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChUcmFuc2FjdGlvbi52YWxpZGF0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKSkudG9CZSh0cnVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZShcIndoZW4gdHJhbnNhY3Rpb24gaXMgaW52YWxpZFwiLCAoKSA9PiB7XHJcbiAgICAgIGRlc2NyaWJlKFwiYW5kIHRoZSB0cmFuc2FjdGlvbiBvdXRwdXRtYXAgdmFsdWUgaXMgaW52YWxpZFwiLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoXCJyZXR1cm5zIGZhbHNlIGFuZCBsb2dzIGFuIGVycm9yXCIsICgpID0+IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uLm91dHB1dE1hcFtzZW5kZXJXYWxsZXQucHVibGljS2V5XSA9IDk5OTk5OTtcclxuICAgICAgICAgIGV4cGVjdChUcmFuc2FjdGlvbi52YWxpZGF0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKSkudG9CZShmYWxzZSk7XHJcbiAgICAgICAgLy8gICBleHBlY3QoZXJyb3JNb2NrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIHRyYW5zYWN0aW9uIGlucHV0IHNpZ25hdHVyZSBpcyBpbnZhbGlkXCIsICgpID0+IHtcclxuICAgICAgICBpdChcInJldHVybnMgZmFsc2UgYW5kIGxvZ3MgYW4gZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb24uaW5wdXQuc2lnbmF0dXJlID0gbmV3IFdhbGxldCgpLnNpZ24oXCJkYXRhXCIpO1xyXG4gICAgICAgICAgZXhwZWN0KFRyYW5zYWN0aW9uLnZhbGlkYXRlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAvLyAgIGV4cGVjdChlcnJvck1vY2spLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==