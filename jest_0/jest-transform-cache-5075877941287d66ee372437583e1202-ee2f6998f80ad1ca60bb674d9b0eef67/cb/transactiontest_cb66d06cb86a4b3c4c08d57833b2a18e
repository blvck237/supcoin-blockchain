adcfdedca00e5e5ff5e6db75f6a6d55d
const Transaction = require("../wallet/transaction/index");

const Wallet = require("../wallet/index");

const {
  verifySignature
} = require("../utils");

describe("Transaction", () => {
  let transaction, senderWallet, receiver, amount;
  beforeEach(() => {
    senderWallet = new Wallet();
    receiver = "receiver-publicKey";
    amount = 20;
    transaction = new Transaction({
      senderWallet,
      receiver,
      amount
    });
  });
  it("has an `id`", () => {
    expect(transaction).toHaveProperty("id");
  });
  describe("outputMap", () => {
    it("has an outputMap", () => {
      expect(transaction).toHaveProperty("outputMap");
    });
    it("outputs amount of receiver", () => {
      expect(transaction.outputMap[receiver]).toEqual(amount);
    });
    it("outputs the remaining balance of the sender", () => {
      expect(transaction.outputMap[senderWallet.publicKey]).toEqual(senderWallet.balance - amount);
    });
  });
  describe("input", () => {
    it("has an `input`", () => {
      expect(transaction).toHaveProperty("input");
    });
    it("has `timestamp` in the `input`", () => {
      expect(transaction.input).toHaveProperty("timestamp");
    });
    it("sets the `amount` to the `senderWallet` balance", () => {
      expect(transaction.input.amount).toEqual(senderWallet.balance);
    });
    it("sets the `address` to the `senderWallet` publicKey", () => {
      expect(transaction.input.address).toEqual(senderWallet.publicKey);
    });
    it("signs the input", () => {
      expect(verifySignature({
        publicKey: senderWallet.publicKey,
        data: transaction.outputMap,
        signature: transaction.input.signature
      })).toBe(true);
    });
  });
  describe("validateTransaction()", () => {
    let errorMock;
    beforeEach(() => {
      errorMock = jest.fn();
      global.console.error = errorMock;
    });
    describe("when the transaction is valid", () => {
      it("returns true", () => {
        expect(Transaction.validateTransaction(transaction)).toBe(true);
      });
    });
    describe("when the transaction is invalid", () => {
      describe("and the transaction outputmap value is invalid", () => {
        it("returns false and logs an error", () => {
          transaction.outputMap[senderWallet.publicKey] = 999999;
          expect(Transaction.validateTransaction(transaction)).toBe(false);
          expect(errorMock).toHaveBeenCalled();
        });
      });
      describe("and the transaction input signature is invalid", () => {
        it("returns false and logs an error", () => {
          transaction.input.signature = new Wallet().sign("data");
          expect(Transaction.validateTransaction(transaction)).toBe(true);
          expect(errorMock).toHaveBeenCalled();
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9uLnRlc3QuanMiXSwibmFtZXMiOlsiVHJhbnNhY3Rpb24iLCJyZXF1aXJlIiwiV2FsbGV0IiwidmVyaWZ5U2lnbmF0dXJlIiwiZGVzY3JpYmUiLCJ0cmFuc2FjdGlvbiIsInNlbmRlcldhbGxldCIsInJlY2VpdmVyIiwiYW1vdW50IiwiYmVmb3JlRWFjaCIsIml0IiwiZXhwZWN0IiwidG9IYXZlUHJvcGVydHkiLCJvdXRwdXRNYXAiLCJ0b0VxdWFsIiwicHVibGljS2V5IiwiYmFsYW5jZSIsImlucHV0IiwiYWRkcmVzcyIsImRhdGEiLCJzaWduYXR1cmUiLCJ0b0JlIiwiZXJyb3JNb2NrIiwiamVzdCIsImZuIiwiZ2xvYmFsIiwiY29uc29sZSIsImVycm9yIiwidmFsaWRhdGVUcmFuc2FjdGlvbiIsInRvSGF2ZUJlZW5DYWxsZWQiLCJzaWduIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxXQUFXLEdBQUdDLE9BQU8sQ0FBQyw2QkFBRCxDQUEzQjs7QUFDQSxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxpQkFBRCxDQUF0Qjs7QUFDQSxNQUFNO0FBQUVFLEVBQUFBO0FBQUYsSUFBc0JGLE9BQU8sQ0FBQyxVQUFELENBQW5DOztBQUNBRyxRQUFRLENBQUMsYUFBRCxFQUFnQixNQUFNO0FBQzVCLE1BQUlDLFdBQUosRUFBaUJDLFlBQWpCLEVBQStCQyxRQUEvQixFQUF5Q0MsTUFBekM7QUFFQUMsRUFBQUEsVUFBVSxDQUFDLE1BQU07QUFDZkgsSUFBQUEsWUFBWSxHQUFHLElBQUlKLE1BQUosRUFBZjtBQUNBSyxJQUFBQSxRQUFRLEdBQUcsb0JBQVg7QUFDQUMsSUFBQUEsTUFBTSxHQUFHLEVBQVQ7QUFDQUgsSUFBQUEsV0FBVyxHQUFHLElBQUlMLFdBQUosQ0FBZ0I7QUFBRU0sTUFBQUEsWUFBRjtBQUFnQkMsTUFBQUEsUUFBaEI7QUFBMEJDLE1BQUFBO0FBQTFCLEtBQWhCLENBQWQ7QUFDRCxHQUxTLENBQVY7QUFPQUUsRUFBQUEsRUFB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RkMsQ0FBRjtBQUdELEtBSk8sQ0FBUjtBQU1BakIsSUFBQUEsUUFBUSxDQUFDLGlDQUFELEVBQW9DLE1BQU07QUFDaERBLE1BQUFBLFFBQVEsQ0FBQyxnREFBRCxFQUFtRCxNQUFNO0FBQy9ETSxRQUFBQSxFQUFFLENBQUMsaUNBQUQsRUFBb0MsTUFBTTtBQUMxQ0wsVUFBQUEsV0FBVyxDQUFDUSxTQUFaLENBQXNCUCxZQUFZLENBQUNTLFNBQW5DLElBQWdELE1BQWhEO0FBRUFKLFVBQUFBLE1BQU0sQ0FBQ1gsV0FBVyxDQUFDNEIsbUJBQVosQ0FBZ0N2QixXQUFoQyxDQUFELENBQU4sQ0FBcURnQixJQUFyRCxDQUEwRCxLQUExRDtBQUNBVixVQUFBQSxNQUFNLENBQUNXLFNBQUQsQ0FBTixDQUFrQk8sZ0JBQWxCO0FBQ0QsU0FMQyxDQUFGO0FBTUQsT0FQTyxDQUFSO0FBU0F6QixNQUFBQSxRQUFRLENBQUMsZ0RBQUQsRUFBbUQsTUFBTTtBQUMvRE0sUUFBQUEsRUFBRSxDQUFDLGlDQUFELEVBQW9DLE1BQU07QUFDMUNMLFVBQUFBLFdBQVcsQ0FBQ1ksS0FBWixDQUFrQkcsU0FBbEIsR0FBOEIsSUFBSWxCLE1BQUosR0FBYTRCLElBQWIsQ0FBa0IsTUFBbEIsQ0FBOUI7QUFFQW5CLFVBQUFBLE1BQU0sQ0FBQ1gsV0FBVyxDQUFDNEIsbUJBQVosQ0FBZ0N2QixXQUFoQyxDQUFELENBQU4sQ0FBcURnQixJQUFyRCxDQUEwRCxJQUExRDtBQUNBVixVQUFBQSxNQUFNLENBQUNXLFNBQUQsQ0FBTixDQUFrQk8sZ0JBQWxCO0FBQ0QsU0FMQyxDQUFGO0FBTUQsT0FQTyxDQUFSO0FBUUQsS0FsQk8sQ0FBUjtBQW1CRCxHQWxDTyxDQUFSO0FBbUNELENBN0ZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoXCIuLi93YWxsZXQvdHJhbnNhY3Rpb24vaW5kZXhcIik7XHJcbmNvbnN0IFdhbGxldCA9IHJlcXVpcmUoXCIuLi93YWxsZXQvaW5kZXhcIik7XHJcbmNvbnN0IHsgdmVyaWZ5U2lnbmF0dXJlIH0gPSByZXF1aXJlKFwiLi4vdXRpbHNcIik7XHJcbmRlc2NyaWJlKFwiVHJhbnNhY3Rpb25cIiwgKCkgPT4ge1xyXG4gIGxldCB0cmFuc2FjdGlvbiwgc2VuZGVyV2FsbGV0LCByZWNlaXZlciwgYW1vdW50O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIHNlbmRlcldhbGxldCA9IG5ldyBXYWxsZXQoKTtcclxuICAgIHJlY2VpdmVyID0gXCJyZWNlaXZlci1wdWJsaWNLZXlcIjtcclxuICAgIGFtb3VudCA9IDIwO1xyXG4gICAgdHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24oeyBzZW5kZXJXYWxsZXQsIHJlY2VpdmVyLCBhbW91bnQgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiaGFzIGFuIGBpZGBcIiwgKCkgPT4ge1xyXG4gICAgZXhwZWN0KHRyYW5zYWN0aW9uKS50b0hhdmVQcm9wZXJ0eShcImlkXCIpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZShcIm91dHB1dE1hcFwiLCAoKSA9PiB7XHJcbiAgICBpdChcImhhcyBhbiBvdXRwdXRNYXBcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24pLnRvSGF2ZVByb3BlcnR5KFwib3V0cHV0TWFwXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJvdXRwdXRzIGFtb3VudCBvZiByZWNlaXZlclwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5vdXRwdXRNYXBbcmVjZWl2ZXJdKS50b0VxdWFsKGFtb3VudCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcIm91dHB1dHMgdGhlIHJlbWFpbmluZyBiYWxhbmNlIG9mIHRoZSBzZW5kZXJcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24ub3V0cHV0TWFwW3NlbmRlcldhbGxldC5wdWJsaWNLZXldKS50b0VxdWFsKFxyXG4gICAgICAgIHNlbmRlcldhbGxldC5iYWxhbmNlIC0gYW1vdW50XHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICBpdChcImhhcyBhbiBgaW5wdXRgXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRyYW5zYWN0aW9uKS50b0hhdmVQcm9wZXJ0eShcImlucHV0XCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJoYXMgYHRpbWVzdGFtcGAgaW4gdGhlIGBpbnB1dGBcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodHJhbnNhY3Rpb24uaW5wdXQpLnRvSGF2ZVByb3BlcnR5KFwidGltZXN0YW1wXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzZXRzIHRoZSBgYW1vdW50YCB0byB0aGUgYHNlbmRlcldhbGxldGAgYmFsYW5jZVwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5pbnB1dC5hbW91bnQpLnRvRXF1YWwoc2VuZGVyV2FsbGV0LmJhbGFuY2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzZXRzIHRoZSBgYWRkcmVzc2AgdG8gdGhlIGBzZW5kZXJXYWxsZXRgIHB1YmxpY0tleVwiLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvbi5pbnB1dC5hZGRyZXNzKS50b0VxdWFsKHNlbmRlcldhbGxldC5wdWJsaWNLZXkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzaWducyB0aGUgaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoXHJcbiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKHtcclxuICAgICAgICAgIHB1YmxpY0tleTogc2VuZGVyV2FsbGV0LnB1YmxpY0tleSxcclxuICAgICAgICAgIGRhdGE6IHRyYW5zYWN0aW9uLm91dHB1dE1hcCxcclxuICAgICAgICAgIHNpZ25hdHVyZTogdHJhbnNhY3Rpb24uaW5wdXQuc2lnbmF0dXJlXHJcbiAgICAgICAgfSlcclxuICAgICAgKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwidmFsaWRhdGVUcmFuc2FjdGlvbigpXCIsICgpID0+IHtcclxuICAgIGxldCBlcnJvck1vY2s7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIGVycm9yTW9jayA9IGplc3QuZm4oKTtcclxuXHJcbiAgICAgIGdsb2JhbC5jb25zb2xlLmVycm9yID0gZXJyb3JNb2NrO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJ3aGVuIHRoZSB0cmFuc2FjdGlvbiBpcyB2YWxpZFwiLCAoKSA9PiB7XHJcbiAgICAgIGl0KFwicmV0dXJucyB0cnVlXCIsICgpID0+IHtcclxuICAgICAgICBleHBlY3QoVHJhbnNhY3Rpb24udmFsaWRhdGVUcmFuc2FjdGlvbih0cmFuc2FjdGlvbikpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJ3aGVuIHRoZSB0cmFuc2FjdGlvbiBpcyBpbnZhbGlkXCIsICgpID0+IHtcclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIHRyYW5zYWN0aW9uIG91dHB1dG1hcCB2YWx1ZSBpcyBpbnZhbGlkXCIsICgpID0+IHtcclxuICAgICAgICBpdChcInJldHVybnMgZmFsc2UgYW5kIGxvZ3MgYW4gZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb24ub3V0cHV0TWFwW3NlbmRlcldhbGxldC5wdWJsaWNLZXldID0gOTk5OTk5O1xyXG5cclxuICAgICAgICAgIGV4cGVjdChUcmFuc2FjdGlvbi52YWxpZGF0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKSkudG9CZShmYWxzZSk7XHJcbiAgICAgICAgICBleHBlY3QoZXJyb3JNb2NrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGVzY3JpYmUoXCJhbmQgdGhlIHRyYW5zYWN0aW9uIGlucHV0IHNpZ25hdHVyZSBpcyBpbnZhbGlkXCIsICgpID0+IHtcclxuICAgICAgICBpdChcInJldHVybnMgZmFsc2UgYW5kIGxvZ3MgYW4gZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb24uaW5wdXQuc2lnbmF0dXJlID0gbmV3IFdhbGxldCgpLnNpZ24oXCJkYXRhXCIpO1xyXG5cclxuICAgICAgICAgIGV4cGVjdChUcmFuc2FjdGlvbi52YWxpZGF0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgIGV4cGVjdChlcnJvck1vY2spLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==